#!/bin/sh
# Realiza formateo automÃ¡tico de Python, Terraform y Shell

# Salir inmediatamente si alguna revisiÃ³n falla
set -e

echo "ðŸ”¹ Iniciando hooks pre-commit"

echo "ðŸ”¹ Verificando formato de Python con Black..."
black --check .

echo "ðŸ”¹ Realizando verificaciones con flake8..."
flake8 .

echo "ðŸ”¹ Revisando formato de Terraform..."
terraform fmt -check

echo "ðŸ”¹ Validando archivos de configuraciÃ³n de Terraform..."
find iac/ -type d | while read -r dir; do
  if [ -f "$dir/main.tf" ]; then
    echo "  ðŸ”Ž Validando en: $dir"
    (
      cd "$dir"
      terraform init -backend=false -input=false -no-color > /dev/null 2>&1
      terraform validate
      terraform fmt -check
    )
  fi
done

echo "ðŸ”¹ RevisiÃ³n con shellcheck..."
find . -type f -name "*.sh" -exec shellcheck {} +

echo "âœ… Â¡Hooks pre-commit superados!"

exit 0
